<!DOCTYPE html>
<html lang="ko"   xmlns:th="http://www.thymeleaf.org" 
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragments/layout}">
<head>
<meta charset="UTF-8">
<title>40db wish list</title>
<!-- CKEditor 로드 -->
<script src="//cdn.ckeditor.com/4.25.1/standard/ckeditor.js"></script> 

<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
<div layout:fragment="content">
<div  class="container p-3">
	<h2>희망도서 신청</h2>
	<h3>자료검색</h3>
	<label for="search" class="p-3">보유중인 장서인지 검색해주세요</label>
	<input type="text" name="search" id="search" class="form-control me-2 w-75" placeholder="검색어를 입력해주세요">
	</div>
  <table class="table table-bordered table-hover container text-center hope_user_search">
  <caption>40db wish list</caption>
    <thead>
      <tr >
        <th>번호</th>
        <th>제목</th> 
        <th>저자</th> 
        <th>출판사</th> 
        <th>ISBN</th> 
        <th>출간일</th> 
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
		<script th:inline="javascript">
			$(function(){
					ajax_api('책제목검색');
					//$(".book_result").hide();
					$("#search").on("keyup", function(){
						$(".hope_user_search").fadeIn();
						let searchQuery = $(this).val().trim(); //입력값 공백없이 
						if(searchQuery.length>0){
							$(".hope_user_search").fadeIn();
							ajax_api(searchQuery);
						}
					});
			});
			function ajax_api(search){
				$.ajax({
					url:"/hopeBook/hope_usersearch/" + search,
					type:"GET",
					datatype:"json",
					contentType:"application/json;charset=UTF-8",
					error:function(xhr, status, msg){alert(status+"/"+msg)},
					success:function(json){ 
						$(".hope_user_search tbody").empty();
						if( json && json.item && json.item.length>0 ){
						console.log("json:"+json);
							let item = json.item;
							for(let i=0; i<item.length; i++){
								//1. 데이터 가벼오기
								let title=item[i].title;
								let author=item[i].author;
								let publisher=item[i].publisher;
								let isbn13=item[i].isbn13;
								let pubdate=item[i].pubDate;
								//2. tbody 행 추가 템플릿 리터럴
								let row = `
									<tr>
										<td></td>
										<td><a href="/hopeBook/write?title=${encodeURIComponent(title)}&author=${encodeURIComponent(author)}&publisher=${encodeURIComponent(publisher)}&isbn13=${encodeURIComponent(isbn13)}">${title}</a></td>
										<td>${author}</td>
										<td>${publisher}</td>
										<td>${isbn13}</td>
										<td>${pubdate}</td>
									</tr>
								`;
								$(".hope_user_search tbody").append(row);
							}
						}else{
							console.log("empty");
						}
						}//end if
					//}
				});
			}
			
		</script>
</form>
</div>
</div>
</body>
</html>